# `DevLogViewer.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/components/dev/DevLogViewer.vue` |
| 関連設計書 | - |
| 設計書記載 | 開発ツールコンポーネント（開発環境でのログ表示、フィルタリング、ダウンロード機能） |

## 2. テストの目的

`DevLogViewer.vue`コンポーネントが、開発環境でのログ表示、フィルタリング、ダウンロード機能を正しく実装していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **モック**: `import.meta.env.DEV`をモック化

## 4. テストケース

### 4.1. 環境による表示制御

| テストNo. | テストケース | `import.meta.env.DEV` | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 1-1 | 開発環境 | `true` | コンポーネントが表示される。 |
| 1-2 | 本番環境 | `false` | コンポーネントが表示されない。 |

### 4.2. トグル機能 (`togglePanel`)

| テストNo. | テストケース | 初期状態 | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- | :--- |
| 2-1 | パネルを開く | `isOpen: false` | トグルボタンクリック | ・`isOpen`がtrueになる。<br>・ログパネルが表示される。<br>・`refreshLogs`が呼び出される。 |
| 2-2 | パネルを閉じる | `isOpen: true` | トグルボタンクリック | ・`isOpen`がfalseになる。<br>・ログパネルが非表示になる。 |

### 4.3. ログフィルタリング (`filteredLogs` computed)

| テストNo. | テストケース | フィルタ条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 3-1 | 全て表示 | `selectedLevel: 'all'` | 全てのログが表示される。 |
| 3-2 | レベルフィルタ | `selectedLevel: 'error'` | `level: 'error'`のログのみ表示される。 |
| 3-3 | キーワード検索（メッセージ） | `searchKeyword: 'login'` | メッセージに`'login'`を含むログが表示される。 |
| 3-4 | キーワード検索（データ） | `searchKeyword: 'userId'` | `data`に`'userId'`を含むログが表示される。 |
| 3-5 | 複合フィルタ | `selectedLevel: 'info'`, `searchKeyword: 'auth'` | 両条件を満たすログのみ表示される。 |
| 3-6 | ソート順 | - | 新しい順（逆順）でソートされる。 |

### 4.4. ログクリア (`handleClear`)

| テストNo. | テストケース | 確認ダイアログ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | クリア確認OK | `confirm`がtrue | ・`clear()`が呼び出される。<br>・`refreshLogs()`が呼び出される。 |
| 4-2 | クリア確認キャンセル | `confirm`がfalse | ログがクリアされない。 |

### 4.5. ダウンロード機能

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | JSON形式ダウンロード | JSONメニューをクリック | `downloadJson()`が呼び出される。 |
| 5-2 | テキスト形式ダウンロード | テキストメニューをクリック | `downloadText()`が呼び出される。 |

### 4.6. ログ表示

| テストNo. | テストケース | ログデータ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-1 | 空のログ | `logs: []` | 「ログがありません」メッセージが表示される。 |
| 6-2 | ログエントリ表示 | ログデータあり | 各エントリにレベルチップ、タイムスタンプ、メッセージが表示される。 |
| 6-3 | データ表示（あり） | `data`プロパティあり | JSON形式で`data`が表示される。 |
| 6-4 | データ表示（なし） | `data`がundefined | データ部分が表示されない。 |

### 4.7. タイムスタンプフォーマット (`formatTimestamp`)

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 7-1 | タイムスタンプ変換 | `'2026-01-05T09:30:45.123Z'` | `'09:30:45.123'`形式で表示される。 |

### 4.8. データフォーマット (`formatData`)

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 8-1 | オブジェクト | `{ key: 'value' }` | インデント付きJSON文字列が返される。 |
| 8-2 | undefined | `undefined` | 空文字列が返される。 |
| 8-3 | 文字列 | `'test'` | `'"test"'`が返される。 |
| 8-4 | 循環参照 | 循環参照オブジェクト | 文字列化された値が返される。 |

### 4.9. レベル色 (`levelColors`)

| テストNo. | テストケース | レベル | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 9-1 | debug | `'debug'` | `'grey'`色のチップが表示される。 |
| 9-2 | info | `'info'` | `'blue'`色のチップが表示される。 |
| 9-3 | warn | `'warn'` | `'orange'`色のチップが表示される。 |
| 9-4 | error | `'error'` | `'red'`色のチップが表示される。 |

### 4.10. UI要素

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 10-1 | ヘッダー | 「開発ログ」タイトルと件数/サイズが表示される。 |
| 10-2 | 閉じるボタン | クリックで`isOpen`がfalseになる。 |
| 10-3 | 更新ボタン | クリックで`refreshLogs()`が呼び出される。 |
| 10-4 | レベルセレクト | 全て/Debug/Info/Warn/Errorの選択肢がある。 |
| 10-5 | 検索フィールド | キーワード入力とクリア機能がある。 |
| 10-6 | バッジ表示 | ログ件数が0より大きい場合、トグルボタンにバッジが表示される。 |
