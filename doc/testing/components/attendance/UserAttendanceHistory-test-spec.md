# `UserAttendanceHistory.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/components/attendance/UserAttendanceHistory.vue` |
| 関連設計書 | [基本設計書 1.3.2](../../design/03-basic/03-basic-design.md#132-月次勤怠一覧画面-attendancelistviewvue) |
| 設計書記載 | 一般ユーザー向け勤怠履歴コンポーネント（日付範囲選択、履歴一覧表示、統計情報） |

## 2. テストの目的

`UserAttendanceHistory.vue`コンポーネントが、一般ユーザー向けの自分の勤怠履歴一覧と統計情報を正しく表示することを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **状態管理**: Pinia (テスト用にモック化)

## 4. テストケース

### 4.1. 初期表示

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 1-1 | タイトル表示 | 「勤怠履歴」が表示される。 |
| 1-2 | 開始日初期値 | 30日前の日付がデフォルト値として設定される。 |
| 1-3 | 終了日初期値 | 今日の日付がデフォルト値として設定される。 |
| 1-4 | テーブルヘッダー | 日付、出勤時刻、退勤時刻、勤務時間、ステータス、備考のカラムが表示される。 |

### 4.2. props

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 2-1 | userId受け取り | `userId: 'user001'` | propsで受け取ったuserIdが使用される。 |

### 4.3. 初期データ取得 (`onMounted`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-1 | 勤怠取得 | `fetchAttendances`が呼び出される。 |
| 3-2 | Storeメソッド呼び出し | `attendanceStore.fetchAttendancesByDateRange(userId, startDate, endDate)`が呼び出される。 |

### 4.4. 日付範囲変更 (`watch [startDate, endDate]`)

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | 開始日変更 | 開始日を変更 | `fetchAttendances`が再実行される。 |
| 4-2 | 終了日変更 | 終了日を変更 | `fetchAttendances`が再実行される。 |

### 4.5. 勤怠履歴取得 (`userAttendanceHistory` computed)

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | データ取得 | キャッシュあり | `attendanceStore.getAttendancesByDateRange`から取得される。 |
| 5-2 | ソート順 | 複数データ | 日付の降順（新しい順）でソートされる。 |

### 4.6. 統計情報 (computed)

#### 4.6.1. 総勤務日数 (`totalWorkDays`)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-1-1 | 勤務日数計算 | `status: 'present'`が3件、`'absent'`が1件 | `3`が表示される。 |
| 6-1-2 | 全て欠勤 | 全て`status: 'absent'` | `0`が表示される。 |

#### 4.6.2. 総勤務時間 (`totalWorkHours`)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-2-1 | 勤務時間計算 | `workingMinutes`合計が540分 | `9`（時間）が表示される。 |
| 6-2-2 | 小数点処理 | `workingMinutes`合計が550分 | `9.2`が表示される（小数点第1位）。 |
| 6-2-3 | データなし | 空配列 | `0`が表示される。 |

#### 4.6.3. 遅刻回数 (`lateCount`)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-3-1 | 遅刻回数計算 | `status: 'late'`が2件 | `2`が表示される。 |

#### 4.6.4. 早退回数 (`earlyLeaveCount`)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-4-1 | 早退回数計算 | `status: 'early_leave'`が1件 | `1`が表示される。 |

### 4.7. ヘルパー関数

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 7-1 | formatDate | `'2026-01-05'` | `'2026/01/05(日)'`形式で返される。 |
| 7-2 | formatTime (Date) | `new Date('2026-01-05T09:30:00')` | `'09:30'`が返される。 |
| 7-3 | formatTime (null) | `null` | `'-'`が返される。 |
| 7-4 | formatWorkingHours | `540` | `'9時間0分'`が返される。 |
| 7-5 | formatWorkingHours | `550` | `'9時間10分'`が返される。 |
| 7-6 | formatWorkingHours (0) | `0` | `'-'`が返される。 |
| 7-7 | getStatusText | `'present'` | `'正常'`が返される。 |
| 7-8 | getStatusColor | `'late'` | `'warning'`が返される。 |

### 4.8. テーブル表示

| テストNo. | テストケース | データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 8-1 | 日付表示 | `date: '2026-01-05'` | フォーマットされた日付が表示される。 |
| 8-2 | 出勤時刻 | `checkIn: Date` | フォーマットされた時刻が表示される。 |
| 8-3 | 出勤時刻（なし） | `checkIn: null` | `'-'`が表示される。 |
| 8-4 | 退勤時刻 | `checkOut: Date` | フォーマットされた時刻が表示される。 |
| 8-5 | 勤務時間 | `workingMinutes: 480` | `'8時間0分'`が表示される。 |
| 8-6 | ステータスチップ | 各ステータス | 適切な色のチップで表示される。 |

### 4.9. 統計カード表示

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 9-1 | 総勤務日数カード | 「総勤務日数」と日数が表示される。 |
| 9-2 | 総勤務時間カード | 「総勤務時間」と時間が表示される。 |
| 9-3 | 遅刻回数カード | 「遅刻回数」と回数が表示される。 |
| 9-4 | 早退回数カード | 「早退回数」と回数が表示される。 |

### 4.10. ローディング状態

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 10-1 | ローディング表示 | `attendanceStore.loading`がtrue | テーブルにローディング状態が表示される。 |
