# `AdminAttendanceList.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/components/attendance/AdminAttendanceList.vue` |
| 関連設計書 | [基本設計書 1.3.2](../../design/03-basic/03-basic-design.md#132-月次勤怠一覧画面-attendancelistviewvue) |
| 設計書記載 | 管理者向け全従業員勤怠一覧コンポーネント（日付選択、勤怠一覧表示） |

## 2. テストの目的

`AdminAttendanceList.vue`コンポーネントが、管理者向けの全従業員勤怠一覧を正しく表示し、日付選択機能が正しく動作することを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **状態管理**: Pinia (テスト用にモック化)

## 4. テストケース

### 4.1. 初期表示

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 1-1 | タイトル表示 | 「勤怠状況一覧」が表示される。 |
| 1-2 | 日付初期値 | 今日の日付がデフォルト値として設定される（`YYYY-MM-DD`形式）。 |
| 1-3 | テーブルヘッダー | 社員番号、名前、役職、出勤時刻、退勤時刻、出勤場所、ステータス、備考のカラムが表示される。 |

### 4.2. 初期データ取得 (`onMounted`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 2-1 | ユーザー取得 | `userStore.fetchUsers()`が呼び出される。 |
| 2-2 | 勤怠取得 | `attendanceStore.fetchAttendancesByDate(selectedDate)`が呼び出される。 |
| 2-3 | 並列実行 | 両方のfetchが`Promise.all`で並列実行される。 |
| 2-4 | エラーハンドリング | 取得失敗時、コンソールにエラーが出力される。 |

### 4.3. 日付変更 (`handleDateChange`)

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 3-1 | 日付変更時の再取得 | 日付を変更 | `attendanceStore.fetchAttendancesByDate(selectedDate)`が呼び出される。 |
| 3-2 | エラーハンドリング | 取得失敗 | コンソールにエラーが出力される。 |

### 4.4. 従業員勤怠リスト (`employeeAttendanceList` computed)

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | 従業員マッピング | 全従業員 | `userStore.employees`の各ユーザーに対してデータが生成される。 |
| 4-2 | 勤怠データあり | 該当日の勤怠あり | 勤怠データがマッピングされる（checkIn、checkOut、status）。 |
| 4-3 | 勤怠データなし | 該当日の勤怠なし | `status: 'absent'`が設定される。 |
| 4-4 | 出勤場所（位置情報あり） | `checkInLocation`あり | モック住所「東京都千代田区丸の内1-1-1」が表示される。 |
| 4-5 | 出勤場所（位置情報なし） | `checkInLocation`なし | `null`が設定される。 |
| 4-6 | 社員番号なし | `employeeNumber`がundefined | `'-'`が表示される。 |

### 4.5. ローディング状態

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | ローディング表示 | `userStore.loading`または`attendanceStore.loading`がtrue | テーブルにローディング状態が表示される。 |

### 4.6. ヘルパー関数

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-1 | formatTime (Date) | `new Date('2026-01-05T09:30:00')` | `'09:30'`が返される。 |
| 6-2 | formatTime (null) | `null` | `'-'`が返される。 |
| 6-3 | getStatusText | `'present'` | `'正常'`が返される。 |
| 6-4 | getStatusText (不明) | `'unknown'` | `'unknown'`がそのまま返される。 |
| 6-5 | getStatusColor | `'late'` | `'warning'`が返される。 |
| 6-6 | getStatusColor (不明) | `'unknown'` | `'grey'`が返される。 |

### 4.7. テーブル表示

| テストNo. | テストケース | データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 7-1 | 社員番号 | `employeeNumber: 'EMP001'` | `'EMP001'`が表示される。 |
| 7-2 | 名前 | `name: '山田太郎'` | `'山田太郎'`が表示される。 |
| 7-3 | 役職（あり） | `position: '主任'` | `'主任'`が表示される。 |
| 7-4 | 役職（なし） | `position: undefined` | `'-'`が表示される。 |
| 7-5 | 出勤時刻 | `checkIn: Date` | フォーマットされた時刻が表示される。 |
| 7-6 | 出勤時刻（なし） | `checkIn: null` | `'-'`が表示される。 |
| 7-7 | ステータスチップ | 各ステータス | 適切な色のチップで表示される。 |
| 7-8 | 備考（あり） | `note: 'メモ'` | `'メモ'`が表示される。 |
| 7-9 | 備考（なし） | `note: ''` | `'-'`が表示される。 |
