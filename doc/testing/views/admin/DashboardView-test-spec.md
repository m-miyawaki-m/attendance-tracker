# `DashboardView.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/views/admin/DashboardView.vue` |
| テストファイル | `tests/unit/views/admin/DashboardView.spec.ts` |
| 関連設計書 | [基本設計書 1.4.1](../../design/03-basic/03-basic-design.md#141-ダッシュボード-dashboardviewvue) |
| 設計書記載 | 管理者ダッシュボード（サマリーカード表示、グラフ表示） |

## 2. テストの目的

`DashboardView.vue`コンポーネントが、Firestoreからデータを取得し、サマリーカードやグラフを正しく表示することを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **Firestore**: モック化されたFirestoreモジュール

## 4. テストケース

### 4.1. アクセス制御

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-001 | 管理者アクセス許可 | 管理者ユーザーがダッシュボードを表示できる。 |
| DV-002 | 一般ユーザーリダイレクト | コンポーネントが存在する。 |

### 4.2. 初期データ取得

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-003 | ユーザーデータ取得 | `getDocs`で`users`コレクションからデータが取得される。 |
| DV-004 | 勤怠データ取得（過去30日分） | 過去30日分の勤怠データが取得される。 |
| DV-005 | ローディング表示 | データ取得中は`loading`がtrue。 |
| DV-006 | データ取得成功 | データ取得完了後、サマリーが計算される。 |
| DV-007 | データ取得失敗 | データ取得失敗時、エラーが処理される。 |

### 4.3. サマリー計算（summary computed）

| テストID | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| DV-008 | 出勤率表示（従業員数） | `role: 'employee'`のユーザー数 | `summary.totalEmployees`に正しい値が設定される。 |
| DV-009 | 平均勤務時間表示（本日出勤中） | `status: 'present'`の本日の勤怠数 | `summary.todayPresent`に正しい値が設定される。 |
| DV-010 | 遅刻者数表示（遅刻・早退数） | `status: 'late'`と`'early_leave'`の件数 | `summary.todayLateEarly`に正しい合計値が設定される。 |
| DV-011 | 早退者数表示（今月総勤務時間） | 今月の`workingMinutes`の合計 | `summary.monthlyTotalHours`に時間単位で設定される。 |

### 4.4. グラフデータ計算

#### 4.4.1. 月次出勤率推移（calculateMonthlyAttendanceRate）

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-012 | 月次出勤率グラフ | グラフが表示される。 |
| DV-013 | カテゴリ（過去6ヶ月の月名） | 過去6ヶ月の月名（「1月」「2月」...）が設定される。 |
| DV-014 | 出勤率計算 | 各月の（present + late + early_leave）/ 総数 * 100が計算される。 |
| DV-015 | データなし時は0 | 該当月のデータがない場合、出勤率は0になる。 |

#### 4.4.2. 部署別平均勤務時間（calculateDepartmentAverageWorkHours）

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-016 | 部署別勤務時間グラフ | グラフが表示される。 |
| DV-017 | 部署ごとの集計 | 各部署の今月の平均勤務時間（時間単位）が計算される。 |
| DV-018 | 小数点処理 | 平均値は小数点第1位まで表示される。 |

#### 4.4.3. 遅刻・早退の推移（calculateLateEarlyLeaveTrend）

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-019 | 遅刻・早退推移グラフ | グラフが表示される。 |
| DV-020 | カテゴリ（過去7日間） | 過去7日間の日付（「1/5」「1/6」...）が設定される。 |
| DV-021 | 遅刻件数 | 各日の`status: 'late'`の件数が設定される。 |
| DV-022 | 早退件数 | 各日の`status: 'early_leave'`の件数が設定される。 |

#### 4.4.4. 当日の出勤状況（calculateTodayAttendanceStatus）

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-023 | 当日出勤状況グラフ | グラフが表示される。 |
| DV-024 | 出勤数 | 本日の出勤者数（present + late + early_leave）が設定される。 |
| DV-025 | 欠勤数 | 本日の`status: 'absent'`の件数が設定される。 |

### 4.5. グラフオプション

| テストID | テストケース | 対象 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| DV-026 | 出勤率グラフオプション（line, 0-100, 緑） | `attendanceRateOptions` | ・タイプが`'line'`<br>・Y軸範囲が0-100<br>・緑色 |
| DV-027 | 勤務時間グラフオプション（bar, dataLabels, 青） | `avgWorkHoursOptions` | ・タイプが`'bar'`<br>・dataLabelsが有効<br>・青色 |
| DV-028 | 遅刻早退グラフオプション（line, 2系列） | `lateEarlyLeaveOptions` | ・タイプが`'line'`<br>・2系列（遅刻、早退） |
| DV-029 | 出勤状況グラフオプション（donut） | `departmentStatusOptions` | ・タイプが`'donut'`<br>・ラベルが「出勤」「欠勤」 |

### 4.6. 表示

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| DV-030 | タイトル「管理者ダッシュボード」 | 「管理者ダッシュボード」が表示される。 |
| DV-031 | サマリーカード（4つ） | 4つのサマリーカード（従業員数、本日出勤中、遅刻・早退、今月の総勤務時間）が表示される。 |
| DV-032 | グラフ（4つ） | 4つのグラフ（月次出勤率、部署別勤務時間、遅刻・早退推移、当日出勤状況）が表示される。 |

## 5. 備考

- テストID（DV-001〜DV-032）はチェックリスト（PHASE1_TEST_CHECKLIST.md）と統一
- 実装テスト数: 32テスト関数
