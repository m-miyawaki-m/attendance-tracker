# `DashboardView.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/views/admin/DashboardView.vue` |
| 関連設計書 | [基本設計書 1.4.1](../../design/03-basic/03-basic-design.md#141-ダッシュボード-dashboardviewvue) |
| 設計書記載 | 管理者ダッシュボード（サマリーカード表示、グラフ表示） |

## 2. テストの目的

`DashboardView.vue`コンポーネントが、Firestoreからデータを取得し、サマリーカードやグラフを正しく表示することを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **Firestore**: モック化されたFirestoreモジュール

## 4. テストケース

### 4.1. 初期データ取得

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 1-1 | ユーザーデータ取得 | `getDocs`で`users`コレクションからデータが取得される。 |
| 1-2 | 勤怠データ取得 | 過去30日分の勤怠データが取得される。`where('date', '>=', startDate)`でクエリされる。 |
| 1-3 | ローディング状態 | データ取得中は`loading`がtrue、完了後falseになる。 |
| 1-4 | エラーハンドリング | データ取得失敗時、コンソールにエラーが出力される。 |

### 4.2. サマリー計算 (`summary` computed)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 2-1 | 従業員数 | `role: 'employee'`のユーザー数 | `summary.totalEmployees`に正しい値が設定される。 |
| 2-2 | 本日出勤中 | `status: 'present'`の本日の勤怠数 | `summary.todayPresent`に正しい値が設定される。 |
| 2-3 | 遅刻・早退数 | `status: 'late'`と`'early_leave'`の本日の勤怠数 | `summary.todayLateEarly`に正しい合計値が設定される。 |
| 2-4 | 今月総勤務時間 | 今月の`workingMinutes`の合計 | `summary.monthlyTotalHours`に時間単位で設定される。 |

### 4.3. グラフデータ計算 (`chartData` computed)

#### 4.3.1. 月次出勤率推移 (`calculateMonthlyAttendanceRate`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-1-1 | カテゴリ | 過去6ヶ月の月名（「1月」「2月」...）が設定される。 |
| 3-1-2 | 出勤率計算 | 各月の（present + late + early_leave）/ 総数 * 100が計算される。 |
| 3-1-3 | データなし | 該当月のデータがない場合、出勤率は0になる。 |

#### 4.3.2. 部署別平均勤務時間 (`calculateDepartmentAverageWorkHours`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-2-1 | 部署ごとの集計 | 各部署の今月の平均勤務時間（時間単位）が計算される。 |
| 3-2-2 | 小数点処理 | 平均値は小数点第1位まで表示される。 |

#### 4.3.3. 遅刻・早退の推移 (`calculateLateEarlyLeaveTrend`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-3-1 | カテゴリ | 過去7日間の日付（「1/5」「1/6」...）が設定される。 |
| 3-3-2 | 遅刻件数 | 各日の`status: 'late'`の件数が設定される。 |
| 3-3-3 | 早退件数 | 各日の`status: 'early_leave'`の件数が設定される。 |

#### 4.3.4. 当日の出勤状況 (`calculateTodayAttendanceStatus`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-4-1 | 出勤数 | 本日の出勤者数（present + late + early_leave）が設定される。 |
| 3-4-2 | 欠勤数 | 本日の`status: 'absent'`の件数が設定される。 |

### 4.4. グラフオプション

| テストNo. | テストケース | 対象 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | 出勤率グラフ | `attendanceRateOptions` | ・タイプが`'line'`<br>・Y軸範囲が0-100<br>・緑色 |
| 4-2 | 勤務時間グラフ | `avgWorkHoursOptions` | ・タイプが`'bar'`<br>・dataLabelsが有効<br>・青色 |
| 4-3 | 遅刻早退グラフ | `lateEarlyLeaveOptions` | ・タイプが`'line'`<br>・2系列（遅刻、早退）<br>・オレンジ、青色 |
| 4-4 | 出勤状況グラフ | `departmentStatusOptions` | ・タイプが`'donut'`<br>・ラベルが「出勤」「欠勤」<br>・緑、赤色 |

### 4.5. 表示

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 5-1 | タイトル | 「管理者ダッシュボード」が表示される。 |
| 5-2 | サマリーカード | 4つのサマリーカード（従業員数、本日出勤中、遅刻・早退、今月の総勤務時間）が表示される。 |
| 5-3 | グラフ | 4つのグラフ（月次出勤率、部署別勤務時間、遅刻・早退推移、当日出勤状況）が表示される。 |
