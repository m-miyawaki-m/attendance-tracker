# `TeamView.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/views/admin/TeamView.vue` |
| 関連設計書 | [基本設計書 1.4.3](../../design/03-basic/03-basic-design.md#143-チーム勤怠管理画面-teamviewvue) |
| 設計書記載 | チーム勤怠管理画面（主任選択、日付選択、チームサマリー表示、チームメンバー勤怠一覧表示） |

## 2. テストの目的

`TeamView.vue`コンポーネントが、主任選択に基づくチームメンバーの勤怠一覧表示、サマリー計算、日付変更機能を正しく実装していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **状態管理**: Pinia (テスト用にモック化)

## 4. テストケース

### 4.1. 初期表示

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 1-1 | タイトル表示 | 「チーム勤怠管理」が表示される。 |
| 1-2 | 日付初期値 | 今日の日付がデフォルト値として設定される。 |
| 1-3 | 主任未選択時 | 「主任を選択してください」メッセージが表示される。 |
| 1-4 | 主任セレクト | 主任リストがドロップダウンに表示される。 |

### 4.2. 初期データ取得 (`onMounted`)

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 2-1 | ユーザー取得 | `userStore.fetchUsers()`が呼び出される。 |
| 2-2 | 勤怠取得 | `attendanceStore.fetchAttendancesByDate(selectedDate)`が呼び出される。 |
| 2-3 | 並列実行 | 両方のfetchが`Promise.all`で並列実行される。 |
| 2-4 | エラーハンドリング | 取得失敗時、loggerにエラーが記録される。 |

### 4.3. 日付変更 (`watch selectedDate`)

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 3-1 | 日付変更時の再取得 | 日付を変更 | `attendanceStore.fetchAttendancesByDate(newDate)`が呼び出される。 |
| 3-2 | ログ出力 | 日付変更 | loggerに日付変更が記録される。 |

### 4.4. 主任選択 (`watch selectedManagerId`)

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | 主任選択時のログ | 主任を選択 | loggerに主任選択が記録される（managerId、managerName、teamMemberCount）。 |
| 4-2 | 主任選択解除 | 選択をクリア | loggerに「主任選択解除」が記録される。 |

### 4.5. 主任リスト (`managers` computed)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | 主任フィルタリング | `position: '主任'`の従業員 | 主任のみがリストに表示される。 |
| 5-2 | ラベル形式 | 主任データ | `'名前 (部署 - 社員番号)'`形式でラベルが設定される。 |

### 4.6. 選択主任名 (`selectedManagerName` computed)

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 6-1 | 主任未選択 | `selectedManagerId`がnull | 空文字列が返される。 |
| 6-2 | 主任選択済み | `selectedManagerId`が設定済み | 主任の名前が返される。 |

### 4.7. チーム勤怠リスト (`teamAttendanceList` computed)

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 7-1 | 主任未選択 | `selectedManagerId`がnull | 空配列が返される。 |
| 7-2 | チームメンバー取得 | 主任選択済み | `userStore.getTeamMembers(managerId)`でメンバーが取得される。 |
| 7-3 | 勤怠データマッピング | メンバーに勤怠あり | 勤怠データがマッピングされる。 |
| 7-4 | 勤怠データなし | メンバーに勤怠なし | `status: 'absent'`が設定される。 |
| 7-5 | 勤務時間計算 | `workingMinutes: 540` | `'9:00'`形式で表示される。 |
| 7-6 | 勤務時間なし | `workingMinutes`がundefined | `'-'`が表示される。 |

### 4.8. チームサマリー (`teamSummary` computed)

| テストNo. | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 8-1 | 総メンバー数 | チームリスト | `totalMembers`にチームメンバー数が設定される。 |
| 8-2 | 正常出勤数 | `status: 'present'`の件数 | `present`に正しい値が設定される。 |
| 8-3 | 遅刻・早退数 | `status: 'late'`と`'early_leave'`の件数 | `lateEarly`に合計値が設定される。 |
| 8-4 | 欠勤数 | `status: 'absent'`の件数 | `absent`に正しい値が設定される。 |

### 4.9. サマリーカード表示

| テストNo. | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 9-1 | 主任選択時 | `selectedManagerId`が設定済み | 4つのサマリーカードが表示される。 |
| 9-2 | 主任未選択時 | `selectedManagerId`がnull | サマリーカードが表示されない。 |

### 4.10. ヘルパー関数

| テストNo. | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 10-1 | formatTime (Date) | `new Date('2026-01-05T09:30:00')` | `'09:30'`が返される。 |
| 10-2 | formatTime (string) | `'2026-01-05T09:30:00'` | `'09:30'`が返される。 |
| 10-3 | formatTime (null) | `null` | `'-'`が返される。 |
| 10-4 | getStatusText | `'present'` | `'正常'`が返される。 |
| 10-5 | getStatusColor | `'late'` | `'warning'`が返される。 |
