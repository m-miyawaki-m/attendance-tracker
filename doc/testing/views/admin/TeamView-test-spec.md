# `TeamView.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/views/admin/TeamView.vue` |
| テストファイル | `tests/unit/views/admin/TeamView.spec.ts` |
| 関連設計書 | [基本設計書 1.4.3](../../design/03-basic/03-basic-design.md#143-チーム勤怠管理画面-teamviewvue) |
| 設計書記載 | チーム勤怠管理画面（主任選択、日付選択、チームサマリー表示、チームメンバー勤怠一覧表示） |

## 2. テストの目的

`TeamView.vue`コンポーネントが、主任選択に基づくチームメンバーの勤怠一覧表示、サマリー計算、日付変更機能を正しく実装していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **状態管理**: Pinia (テスト用にモック化)

## 4. テストケース

### 4.1. 初期表示

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| TV-001 | タイトル表示 | 「チーム勤怠管理」が表示される。 |
| TV-002 | 日付初期値 | 今日の日付がデフォルト値として設定される。 |
| TV-003 | 主任未選択時 | 「主任を選択してください」メッセージが表示される。 |
| TV-004 | 主任セレクト | 主任リストがドロップダウンに表示される。 |

### 4.2. 初期データ取得 (`onMounted`)

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| TV-005 | ユーザー取得 | `userStore.fetchUsers()`が呼び出される。 |
| TV-006 | 勤怠取得 | `attendanceStore.fetchAttendancesByDate(selectedDate)`が呼び出される。 |
| TV-007 | 並列実行 | 両方のfetchが`Promise.all`で並列実行される。 |
| TV-008 | エラーハンドリング | 取得失敗時、loggerにエラーが記録される。 |

### 4.3. 日付変更 (`watch selectedDate`)

| テストID | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-009 | 日付変更時の再取得 | 日付を変更 | `attendanceStore.fetchAttendancesByDate(newDate)`が呼び出される。 |
| TV-010 | ログ出力 | 日付変更 | loggerに日付変更が記録される。 |

### 4.4. 主任選択 (`watch selectedManagerId`)

| テストID | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-011 | 主任選択時のログ | 主任を選択 | loggerに主任選択が記録される（managerId、managerName、teamMemberCount）。 |
| TV-012 | 主任選択解除 | 選択をクリア | loggerに「主任選択解除」が記録される。 |

### 4.5. 主任リスト (`managers` computed)

| テストID | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-013 | 主任フィルタリング | `position: '主任'`の従業員 | 主任のみがリストに表示される。 |
| TV-014 | ラベル形式 | 主任データ | `'名前 (部署 - 社員番号)'`形式でラベルが設定される。 |

### 4.6. 選択主任名 (`selectedManagerName` computed)

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-015 | 主任未選択 | `selectedManagerId`がnull | 空文字列が返される。 |
| TV-016 | 主任選択済み | `selectedManagerId`が設定済み | 主任の名前が返される。 |

### 4.7. チーム勤怠リスト (`teamAttendanceList` computed)

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-017 | 主任未選択 | `selectedManagerId`がnull | 空配列が返される。 |
| TV-018 | チームメンバー取得 | 主任選択済み | `userStore.getTeamMembers(managerId)`でメンバーが取得される。 |
| TV-019 | 勤怠データマッピング | メンバーに勤怠あり | 勤怠データがマッピングされる。 |
| TV-020 | 勤怠データなし | メンバーに勤怠なし | `status: 'absent'`が設定される。 |
| TV-021 | 勤務時間計算 | `workingMinutes: 540` | `'9:00'`形式で表示される。 |
| TV-022 | 勤務時間なし | `workingMinutes`がundefined | `'-'`が表示される。 |

### 4.8. チームサマリー (`teamSummary` computed)

| テストID | テストケース | 入力データ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-023 | 総メンバー数 | チームリスト | `totalMembers`にチームメンバー数が設定される。 |
| TV-024 | 正常出勤数 | `status: 'present'`の件数 | `present`に正しい値が設定される。 |
| TV-025 | 遅刻・早退数 | `status: 'late'`と`'early_leave'`の件数 | `lateEarly`に合計値が設定される。 |
| TV-026 | 欠勤数 | `status: 'absent'`の件数 | `absent`に正しい値が設定される。 |

### 4.9. サマリーカード表示

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-027 | 主任選択時 | `selectedManagerId`が設定済み | 4つのサマリーカードが表示される。 |
| TV-028 | 主任未選択時 | `selectedManagerId`がnull | サマリーカードが表示されない。 |

### 4.10. ヘルパー関数

| テストID | テストケース | 入力 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| TV-029 | formatTime (Date) | `new Date('2026-01-05T09:30:00')` | `'09:30'`が返される。 |

## 5. 備考

- テストID（TV-001〜TV-029）はチェックリスト（PHASE2_TEST_CHECKLIST.md）と統一
- 実装テスト数: 29テスト関数
