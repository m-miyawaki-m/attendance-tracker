# `HomeView.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/views/HomeView.vue` |
| テストファイル | `tests/unit/views/HomeView.spec.ts` |
| 関連設計書 | [基本設計書 1.3.1](../../design/03-basic/03-basic-design.md#131-打刻画面-homeviewvue) |
| 設計書記載 | 打刻画面（リアルタイム時刻表示、出退勤打刻、位置情報取得） |

## 2. テストの目的

`HomeView.vue`コンポーネントが、現在時刻の表示、出退勤打刻機能、位置情報取得、勤務状態の表示を正しく実装していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **コンポーネントテスト**: Vue Test Utils
* **状態管理**: Pinia (テスト用にモック化)
* **モック**: vi.useFakeTimers (時刻操作)、navigator.geolocation (位置情報モック)

## 4. テストケース

### 4.1. 初期表示・時刻表示

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| HV-001 | 画面タイトル「打刻」表示 | 画面に「出勤」「退勤」ボタンが表示される。 |
| HV-002 | 現在時刻がHH:mm:ss形式で表示 | 現在時刻が`HH:mm:ss`形式で表示される。 |
| HV-003 | 日付表示（YYYY年MM月DD日 曜日） | 現在日付が「YYYY年MM月DD日 曜日」形式で表示される。 |
| HV-004 | 時刻自動更新（1秒ごと） | 1秒ごとに時刻表示が更新される。 |
| HV-005 | 初期打刻状態読み込み（loadAttendanceState） | マウント時に今日の打刻状態が読み込まれる。 |

### 4.2. 出勤打刻（handleCheckIn）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-006 | 出勤ボタン表示（未出勤時有効） | 未出勤時 | 出勤ボタンが有効化される。 |
| HV-007 | 出勤打刻成功 | ログイン済み、位置情報取得成功 | ・`clockIn`が呼び出される。<br>・成功スナックバーが表示される。 |
| HV-008 | 出勤後ボタン無効化 | 出勤後 | 出勤ボタンが非活性化される。 |
| HV-009 | 出勤時刻表示 | 出勤後 | 出勤時刻が表示される。 |
| HV-010 | 出勤打刻成功（位置情報失敗時） | 位置情報取得失敗 | デフォルト位置で打刻される。 |
| HV-011 | 出勤打刻失敗 | ストアがエラーを返す | エラースナックバーが表示される。 |
| HV-012 | ユーザー未ログイン時 | `authStore.user`がnull | エラースナックバーが表示される。 |

### 4.3. 退勤打刻（handleCheckOut）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-013 | 退勤ボタン表示（出勤済み時有効） | 出勤済み、未退勤 | 退勤ボタンが有効化される。 |
| HV-014 | 退勤打刻成功 | 出勤済み、未退勤 | ・`clockOut`が呼び出される。<br>・成功スナックバーが表示される。 |
| HV-015 | 退勤後ボタン無効化 | 退勤後 | 退勤ボタンが非活性化される。 |
| HV-016 | 勤務時間表示 | 退勤後 | 勤務時間が表示される。 |
| HV-017 | 退勤打刻失敗 | ストアがエラーを返す | エラースナックバーが表示される。 |
| HV-018 | 未出勤時は退勤ボタン非活性 | 未出勤 | 退勤ボタンが非活性化される。 |

### 4.4. 勤務状態表示（currentStatus）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-019 | 未出勤時の表示 | `checkInTime`がnull | ステータス表示なし |
| HV-020 | 正常出勤の表示 | 9:00以前に出勤 | ステータスが「正常」（緑）で表示される。 |
| HV-021 | 遅刻の表示 | 9:00以降に出勤 | ステータスが「遅刻」（警告色）で表示される。 |
| HV-022 | 早退の表示 | 18:00前に退勤（遅刻でない場合） | ステータスが「早退」で表示される。 |

### 4.5. 勤務時間計算（workingHours）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-023 | 未出勤時（'-'表示） | `checkInTime`がnull | `'-'`が表示される。 |
| HV-024 | 勤務中（経過時間表示） | 出勤済み、未退勤 | 出勤時刻から現在時刻までの時間が表示される。 |
| HV-025 | 退勤済み（勤務時間表示） | 出勤済み、退勤済み | 出勤時刻から退勤時刻までの時間が表示される。 |

### 4.6. 位置情報取得（getCurrentLocation）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-026 | 位置情報取得成功 | `navigator.geolocation`が成功 | `Location`オブジェクトが返される。 |
| HV-027 | 位置情報取得失敗 | Geolocationエラー | エラーがrejectされる。 |
| HV-028 | 位置情報未サポート | `navigator.geolocation`がundefined | エラーがrejectされる。 |
| HV-029 | 権限拒否 | `PERMISSION_DENIED`エラー | 「位置情報の許可が拒否されました」がrejectされる。 |
| HV-030 | 位置情報利用不可 | `POSITION_UNAVAILABLE`エラー | 「位置情報が利用できません」がrejectされる。 |
| HV-031 | タイムアウト | `TIMEOUT`エラー | 「位置情報の取得がタイムアウトしました」がrejectされる。 |

### 4.7. 住所変換（getAddressFromCoords）

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-032 | 住所取得成功 | Nominatim APIが正常応答 | 住所文字列が返される。 |
| HV-033 | 住所取得失敗 | APIエラー | `'住所不明'`が返される。 |

### 4.8. ライフサイクル

| テストID | テストケース | イベント | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-034 | マウント時の処理 | `onMounted` | タイマーがセットされる。 |
| HV-035 | アンマウント時のタイマークリア | `onUnmounted` | タイマーがクリアされる。 |

### 4.9. ローディング状態

| テストID | テストケース | 条件 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| HV-036 | APIエラー時の表示 | APIエラー | エラー表示される。 |
| HV-037 | ローディング状態表示 | `loading`がtrue | オーバーレイとプログレスサークルが表示される。 |
| HV-038 | ボタン非活性化 | `loading`がtrue | 出勤・退勤ボタンが非活性化される。 |

## 5. 備考

- テストID（HV-001〜HV-038）はチェックリスト（PHASE1_TEST_CHECKLIST.md）と統一
- 実装テスト数: 38テスト関数
