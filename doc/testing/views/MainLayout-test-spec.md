# `MainLayout.vue` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/layouts/MainLayout.vue` |
| 関連設計書 | [基本設計書 1.2.2](../../design/03-basic/03-basic-design.md#122-共通レイアウト-mainlayoutvue) |
| 設計書記載 | 共通レイアウト（メインヘッダー、タブナビゲーション、サイドバー、メインコンテンツ） |

## 2. テストの目的

`MainLayout.vue`コンポーネントが、渡される`props`や認証状態（Piniaストア）、ユーザー権限に応じて、UI要素（ヘッダー、サイドバー、タブなど）を正しく表示・非表示にできることを保証する。また、ログアウトなどのユーザーインタラクションが期待通りに機能することを確認する。

## 3. 使用するライブラリ

*   **テストランナー**: Vitest
*   **コンポーネントテスト**: Vue Test Utils
*   **状態管理**: Pinia (テスト用にモック化)
*   **ルーティング**: Vue Router (テスト用にモック化)

## 4. テストケース

### 4.1. 表示制御 (`props`)

`showHeader`, `showSidebar`, `showFooter`, `showTabs`の`props`に応じて、各UIパーツが正しくレンダリングされるか、またはレンダリングされないかを確認する。

| テストNo. | テストケース | `props` | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 1-1 | ヘッダー表示 | `showHeader: true` | `v-app-bar`（メインヘッダー）が表示される。 |
| 1-2 | ヘッダー非表示 | `showHeader: false` | `v-app-bar`（メインヘッダー）が表示されない。 |
| 1-3 | サイドバー表示 | `showSidebar: true` | `v-navigation-drawer`が表示される。 |
| 1-4 | サイドバー非表示 | `showSidebar: false` | `v-navigation-drawer`が表示されない。 |
| 1-5 | フッター表示 | `showFooter: true` | `v-footer`が表示される。 |
| 1-6 | フッター非表示 | `showFooter: false` | `v-footer`が表示されない。 |
| 1-7 | タブ表示 | `showTabs: true` | タブ用の`v-app-bar`が表示される。 |
| 1-8 | タブ非表示 | `showTabs: false` | タブ用の`v-app-bar`が表示されない。 |

### 4.2. 認証状態

ユーザーの認証状態（ログイン/未ログイン）に応じて、ヘッダー内の要素が正しく表示されることを確認する。

| テストNo. | テストケース | ストアの状態 (`authStore`) | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 2-1 | ログイン状態 | `isAuthenticated: true`, `userName: 'テストユーザー'` | ・ユーザー名（`テストユーザー`）が表示される。<br>・ログアウトボタンが表示される。 |
| 2-2 | 未ログイン状態 | `isAuthenticated: false` | ・ユーザー名が表示されない。<br>・ログアウトボタンが表示されない。 |

### 4.3. ユーザー権限（タブ表示）

ユーザーの権限（一般ユーザー/管理者）に応じて、タブナビゲーションの内容が正しく切り替わることを確認する。

| テストNo. | テストケース | ストアの状態 (`authStore`) | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 3-1 | 一般ユーザー | `isAdmin: false` | ・`props.showTabs`が`true`の時、「打刻」と「勤怠一覧」のタブが表示される。 |
| 3-2 | 管理者 | `isAdmin: true` | ・`props.showTabs`が`true`の時、「ダッシュボード」「従業員管理」「チーム勤怠」のタブが表示される。 |

### 4.4. ユーザーインタラクション

ユーザー操作に対するコンポーネントの反応をテストする。

| テストNo. | テストケース | 操作 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | ログアウト成功 | ログアウトボタンをクリック | ・`authStore.logout`が呼び出される。<br>・`router.push('/login')`が呼び出される。<br>・成功メッセージ付きのスナックバーが表示される。 |
| 4-2 | ログアウト失敗 | ログアウトボタンをクリック (ストアのlogoutがエラーをスロー) | ・`authStore.logout`が呼び出される。<br>・`router.push`が呼び出されない。<br>・エラーメッセージ付きのスナックバーが表示される。 |
| 4-3 | サイドバー開閉 | `props.showSidebar`が`true`の時、ハンバーガーメニューアイコンをクリック | ・`v-navigation-drawer`の表示/非表示が切り替わる。 |

### 4.5. 内部ロジック

コンポーネント内部の算出プロパティやメソッドの動作を確認する。

| テストNo. | テストケース | 概要 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | フッターの年表示 | `currentYear` | 現在の西暦年が正しく計算され、フッターに表示される。 |
| 5-2 | スナックバー表示 | `defineExpose`された`showSnackbar`メソッドを呼び出す | ・指定したメッセージと色で`v-snackbar`が表示される。 |
| 5-3 | アクティブメニュー | `isActive`メソッド | 現在のルートパス(`useRoute().path`)と一致するメニュー項目がアクティブ状態になる。 |
