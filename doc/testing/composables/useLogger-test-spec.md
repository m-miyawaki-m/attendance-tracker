# `useLogger.ts` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/composables/useLogger.ts` |
| 関連設計書 | - |
| 設計書記載 | コンポーザブル（ログ機能をVueコンポーネントで利用しやすい形で提供） |

## 2. テストの目的

`useLogger.ts`コンポーザブルが、ログ機能をVueコンポーネントで利用しやすい形で提供していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **Vue**: @vue/test-utils

## 4. テストケース

### 4.1. 初期化

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 1-1 | 初期ログ読み込み | `logs`に`getLogs()`の結果が設定される。 |
| 1-2 | リスナー登録 | `onLogUpdate`でリスナーが登録される。 |

### 4.2. State

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 2-1 | logs | ref型でLogEntry配列を保持する。 |
| 2-2 | isLoading | ref型でboolean値を保持する（初期値false）。 |

### 4.3. refreshLogs 関数

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 3-1 | ログ再読み込み | `logs.value`が`getLogs()`の結果で更新される。 |

### 4.4. logCount computed

| テストNo. | テストケース | logsデータ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 4-1 | 件数取得 | 50件 | `50`を返す。 |
| 4-2 | 空の場合 | 0件 | `0`を返す。 |
| 4-3 | リアクティブ更新 | ログ追加時 | 自動的に更新される。 |

### 4.5. logSizeFormatted computed

| テストNo. | テストケース | サイズ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 5-1 | バイト表示 | 500B | `'500 B'` |
| 5-2 | KB表示 | 2048B | `'2.0 KB'` |
| 5-3 | MB表示 | 2MB | `'2.0 MB'` |
| 5-4 | リアクティブ更新 | ログ追加時 | 自動的に更新される。 |

### 4.6. clear 関数

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 6-1 | クリア実行 | ・`clearLogs()`が呼び出される。<br>・`logs.value`が空配列になる。 |

### 4.7. downloadJson 関数

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 7-1 | JSONダウンロード | `downloadLogsAsJson()`が呼び出される。 |

### 4.8. downloadText 関数

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 8-1 | テキストダウンロード | `downloadLogsAsText()`が呼び出される。 |

### 4.9. filterByLevel 関数

| テストNo. | テストケース | level引数 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 9-1 | 全て | `'all'` | 全ログを返す。 |
| 9-2 | errorのみ | `'error'` | `level: 'error'`のログのみ返す。 |
| 9-3 | infoのみ | `'info'` | `level: 'info'`のログのみ返す。 |

### 4.10. searchLogs 関数

| テストNo. | テストケース | keyword引数 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| 10-1 | 空文字 | `''` | 全ログを返す。 |
| 10-2 | メッセージ検索 | `'login'` | messageに`'login'`を含むログを返す。 |
| 10-3 | データ検索 | `'userId'` | dataに`'userId'`を含むログを返す。 |
| 10-4 | 大文字小文字無視 | `'LOGIN'` | 大文字小文字を区別せずに検索する。 |

### 4.11. logger インスタンス

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 11-1 | エクスポート | `logger`インスタンスが返り値に含まれる。 |

### 4.12. ライフサイクル

| テストNo. | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| 12-1 | アンマウント時 | `onUnmounted`でリスナーが解除される。 |
| 12-2 | リスナー自動更新 | ログ追加時に`logs.value`が自動更新される。 |
