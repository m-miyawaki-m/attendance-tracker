# `useLogger.ts` 単体テスト仕様書

## 1. 概要

| 項目 | 内容 |
|:---|:---|
| 対象ファイル | `src/composables/useLogger.ts` |
| テストファイル | `tests/unit/composables/useLogger.spec.ts` |
| 関連設計書 | - |
| 設計書記載 | コンポーザブル（ログ機能をVueコンポーネントで利用しやすい形で提供） |

## 2. テストの目的

`useLogger.ts`コンポーザブルが、ログ機能をVueコンポーネントで利用しやすい形で提供していることを保証する。

## 3. 使用するライブラリ

* **テストランナー**: Vitest
* **Vue**: @vue/test-utils

## 4. テストケース

### 4.1. 初期化

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-001 | 初期ログ読み込み | `logs`に`getLogs()`の結果が設定される。 |
| UL-002 | リスナー登録 | `onLogUpdate`でリスナーが登録される。 |

### 4.2. State

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-003 | logs | ref型でLogEntry配列を保持する。 |
| UL-004 | isLoading | ref型でboolean値を保持する（初期値false）。 |

### 4.3. refreshLogs 関数

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-005 | ログ再読み込み | `logs.value`が`getLogs()`の結果で更新される。 |

### 4.4. logCount computed

| テストID | テストケース | logsデータ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| UL-006 | 件数取得 | 50件 | `50`を返す。 |
| UL-007 | 空の場合 | 0件 | `0`を返す。 |
| UL-008 | リアクティブ更新 | ログ追加時 | 自動的に更新される。 |

### 4.5. logSizeFormatted computed

| テストID | テストケース | サイズ | 期待する結果 |
| :--- | :--- | :--- | :--- |
| UL-009 | バイト表示 | 500B | `'500 B'` |
| UL-010 | KB表示 | 2048B | `'2.0 KB'` |
| UL-011 | MB表示 | 2MB | `'2.0 MB'` |
| UL-012 | リアクティブ更新 | ログ追加時 | 自動的に更新される。 |

### 4.6. clear 関数

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-013 | クリア実行 | ・`clearLogs()`が呼び出される。<br>・`logs.value`が空配列になる。 |

### 4.7. downloadJson 関数

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-014 | JSONダウンロード | `downloadLogsAsJson()`が呼び出される。 |

### 4.8. downloadText 関数

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-015 | テキストダウンロード | `downloadLogsAsText()`が呼び出される。 |

### 4.9. filterByLevel 関数

| テストID | テストケース | level引数 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| UL-016 | 全て | `'all'` | 全ログを返す。 |
| UL-017 | errorのみ | `'error'` | `level: 'error'`のログのみ返す。 |
| UL-018 | infoのみ | `'info'` | `level: 'info'`のログのみ返す。 |

### 4.10. searchLogs 関数

| テストID | テストケース | keyword引数 | 期待する結果 |
| :--- | :--- | :--- | :--- |
| UL-019 | 空文字 | `''` | 全ログを返す。 |
| UL-020 | メッセージ検索 | `'login'` | messageに`'login'`を含むログを返す。 |
| UL-021 | データ検索 | `'userId'` | dataに`'userId'`を含むログを返す。 |
| UL-022 | 大文字小文字無視 | `'LOGIN'` | 大文字小文字を区別せずに検索する。 |

### 4.11. logger インスタンス

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-023 | エクスポート | `logger`インスタンスが返り値に含まれる。 |

### 4.12. ライフサイクル

| テストID | テストケース | 期待する結果 |
| :--- | :--- | :--- |
| UL-024 | アンマウント時 | `onUnmounted`でリスナーが解除される。 |
| UL-025 | リスナー自動更新 | ログ追加時に`logs.value`が自動更新される。 |

## 5. 備考

- テストID（UL-001〜UL-025）はチェックリスト（PHASE2_TEST_CHECKLIST.md）と統一
- 実装テスト数: 25テスト関数
